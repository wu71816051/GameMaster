/**
 * éª°å­æœåŠ¡
 *
 * @description
 * è´Ÿè´£å¤„ç†éª°å­æ·éª°çš„ä¸šåŠ¡é€»è¾‘ï¼ŒåŒ…æ‹¬ï¼š
 * - è°ƒç”¨éª°å­è§£æå™¨è¿›è¡Œæ·éª°
 * - åœ¨æ´»è·ƒä¼šè¯ä¸­è®°å½•æ·éª°ç»“æœ
 *
 * @module services/dice.service
 */

import { Context } from 'koishi'
import { DiceParser, DiceResult } from '../utils/dice-parser'
import { DiceFormatter } from '../utils/dice-formatter'
import { ConversationService } from './conversation.service'
import { ContentType, MessageType } from '../models/conversation-message'

/**
 * æ·éª°å‚æ•°æ¥å£
 */
export interface RollDiceParams {
  /** éª°å­è¡¨è¾¾å¼ */
  expression: string
  /** ç”¨æˆ· ID */
  userId: number
  /** é¢‘é“ä¿¡æ¯ */
  channel: {
    platform: string
    guildId: string
    channelId: string
  }
  /** æè¿°ï¼ˆå¯é€‰ï¼‰ */
  description?: string
}

/**
 * æ·éª°ç»“æœæ¥å£
 */
export interface RollDiceResult {
  /** æ˜¯å¦æˆåŠŸ */
  success: boolean
  /** åŸå§‹æ·éª°æ•°æ®ï¼ˆæˆåŠŸæ—¶è¿”å›ï¼‰ */
  diceResult?: DiceResult
  /** é”™è¯¯æ¶ˆæ¯ï¼ˆå¤±è´¥æ—¶ï¼‰ */
  error?: string
}

/**
 * éª°å­æœåŠ¡ç±»
 */
export class DiceService {
  private ctx: Context
  private logger: typeof Context.prototype.logger
  private conversationService: ConversationService

  constructor(ctx: Context) {
    this.ctx = ctx
    this.logger = ctx.logger
    this.conversationService = new ConversationService(ctx)
  }

  /**
   * æ·éª°å­
   *
   * @description
   * è§£æéª°å­è¡¨è¾¾å¼å¹¶æ‰§è¡Œæ·éª°ï¼Œå¦‚æœåœ¨æ´»è·ƒä¼šè¯ä¸­åˆ™è®°å½•ç»“æœã€‚
   *
   * @param params - æ·éª°å‚æ•°
   * @returns æ·éª°ç»“æœ
   */
  async rollDice(params: RollDiceParams): Promise<RollDiceResult> {
    try {
      // 1. éªŒè¯è¡¨è¾¾å¼
      if (!params.expression || params.expression.trim().length === 0) {
        return {
          success: false,
          error: 'éª°å­è¡¨è¾¾å¼ä¸èƒ½ä¸ºç©º',
        }
      }

      // 2. è§£æå¹¶è®¡ç®—éª°å­è¡¨è¾¾å¼
      let diceResult: DiceResult
      try {
        diceResult = DiceParser.evaluate(params.expression)
      } catch (error) {
        this.logger.warn('[DiceService] éª°å­è¡¨è¾¾å¼è§£æå¤±è´¥', error)
        return {
          success: false,
          error: `æ— æ•ˆçš„éª°å­è¡¨è¾¾å¼: ${params.expression}`,
        }
      }

      // 3. æ£€æŸ¥æ˜¯å¦åœ¨æ´»è·ƒä¼šè¯ä¸­
      const activeConversation = await this.conversationService.getActiveConversation({
        channel: params.channel,
      })

      // 4. å¦‚æœåœ¨æ´»è·ƒä¼šè¯ä¸­ï¼Œè®°å½•æ·éª°ç»“æœ
      if (activeConversation) {
        await this.recordDiceRoll({
          conversationId: activeConversation.id!,
          userId: params.userId,
          expression: params.expression,
          diceResult,
          description: params.description,
          channel: params.channel,
        })
        this.logger.info(
          `[DiceService] ç”¨æˆ· ${params.userId} åœ¨ä¼šè¯ ${activeConversation.id} ä¸­æ·éª°: ${params.expression} = ${diceResult.total}`
        )
      } else {
        this.logger.info(`[DiceService] ç”¨æˆ· ${params.userId} æ·éª°: ${params.expression} = ${diceResult.total}`)
      }

      return {
        success: true,
        diceResult,
      }
    } catch (error) {
      this.logger.error('[DiceService] æ·éª°å¤±è´¥', error)
      return {
        success: false,
        error: 'æ·éª°å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•',
      }
    }
  }

  /**
   * è®°å½•æ·éª°ç»“æœåˆ°ä¼šè¯æ¶ˆæ¯è¡¨
   *
   * @param params - è®°å½•å‚æ•°
   */
  private async recordDiceRoll(params: {
    conversationId: number
    userId: number
    expression: string
    diceResult: DiceResult
    description?: string
    channel: {
      platform: string
      guildId: string
      channelId: string
    }
  }): Promise<void> {
    try {
      // ç”Ÿæˆæ¶ˆæ¯ IDï¼ˆåŸºäºæ—¶é—´æˆ³å’Œéšæœºæ•°ï¼‰
      const messageId = `dice_${Date.now()}_${Math.random().toString(36).substring(2, 9)}`

      // æ„å»ºæ¶ˆæ¯å†…å®¹ï¼ˆä½¿ç”¨ DiceFormatter å·¥å…·ç±»ï¼‰
      const content = DiceFormatter.format(params.diceResult, {
        description: params.description,
      })

      // è®°å½•åˆ°æ•°æ®åº“
      await this.ctx.database.create('conversation_message', {
        conversation_id: params.conversationId,
        user_id: params.userId,
        message_id: messageId,
        content,
        content_type: ContentType.CHECK,
        message_type: MessageType.TEXT,
        timestamp: new Date(),
        platform: params.channel.platform,
        guild_id: params.channel.guildId,
        channel_id: params.channel.channelId,
      } as any)

      this.logger.debug(`[DiceService] æ·éª°ç»“æœå·²è®°å½•åˆ°ä¼šè¯ ${params.conversationId}`)
    } catch (error) {
      this.logger.error('[DiceService] è®°å½•æ·éª°ç»“æœå¤±è´¥', error)
      // è®°å½•å¤±è´¥ä¸å½±å“æ·éª°ç»“æœï¼Œä»…è®°å½•é”™è¯¯æ—¥å¿—
    }
  }

  /**
   * è·å–ç®€è¦å¸®åŠ©ä¿¡æ¯
   *
   * @returns ç®€è¦å¸®åŠ©æ–‡æœ¬
   */
  getBriefHelp(): string {
    return `ğŸ² éª°å­ç³»ç»Ÿ - å¿«é€ŸæŒ‡å—
    
ğŸ“– åŸºç¡€ç”¨æ³•ï¼š
  .r <è¡¨è¾¾å¼>   - æ·éª°å­
  .rd <è¡¨è¾¾å¼> <æè¿°> - å¸¦æè¿°çš„æ·éª°
  .rh           - æ˜¾ç¤ºæ­¤ç®€è¦å¸®åŠ©
  .rh -d        - æ˜¾ç¤ºè¯¦ç»†å¸®åŠ©ï¼ˆå« TRPG åœºæ™¯ï¼‰

ğŸ¯ åŸºç¡€éª°å­ï¼š
  d20           - æ· 1 ä¸ª 20 é¢éª°
  3d6           - æ· 3 ä¸ª 6 é¢éª°å¹¶æ±‚å’Œ
  2d10+5        - æ· 2 ä¸ª 10 é¢éª°å¹¶åŠ  5

ğŸ”§ ä¿ç•™/ä¸¢å¼ƒä¿®é¥°ç¬¦ï¼š
  4d6kh1        - æ· 4 ä¸ªéª°å­ï¼Œä¿ç•™æœ€é«˜ 1 ä¸ª
  4d6kl1        - æ· 4 ä¸ªéª°å­ï¼Œä¿ç•™æœ€ä½ 1 ä¸ª
  4d6dh1        - æ· 4 ä¸ªéª°å­ï¼Œä¸¢å¼ƒæœ€é«˜ 1 ä¸ª
  4d6dl1        - æ· 4 ä¸ªéª°å­ï¼Œä¸¢å¼ƒæœ€ä½ 1 ä¸ª

ğŸ”„ é‡éª°æœºåˆ¶ï¼š
  2d10r2        - æ·å‡º â‰¤2 æ—¶é‡éª°ä¸€æ¬¡
  2d10rr2       - æ·å‡º â‰¤2 æ—¶é€’å½’é‡éª°ï¼ˆç›´åˆ° >2ï¼‰

ğŸ’¥ çˆ†éª°æœºåˆ¶ï¼š
  d20!          - æ·å‡ºæœ€å¤§å€¼æ—¶å†éª°å¹¶ç´¯åŠ 
  2d6!          - æ¯ä¸ªéª°å­ç‹¬ç«‹çˆ†éª°

ğŸ§® å¤æ‚è¡¨è¾¾å¼ï¼š
  3d6+2d4-1     - å¤šä¸ªéª°å­ç±»å‹ç»„åˆ
  4d6kh1+2      - ä¿ç•™æœ€é«˜ + ä¿®æ­£å€¼
  2d10r2kh1     - é‡éª° + ä¿ç•™æœ€é«˜

âš ï¸ æ³¨æ„äº‹é¡¹ï¼š
  é™¤æ³•ä¸ºæ•´é™¤ï¼ˆ7/2=3ï¼‰
  é‡éª°é˜ˆå€¼å¿…é¡» < éª°å­é¢æ•°

ğŸ’¡ æŸ¥çœ‹è¯¦ç»†å¸®åŠ©å’Œ TRPG åœºæ™¯è¯·è¾“å…¥ï¼š.rh -d`
  }

  /**
   * è·å–éª°å­è¡¨è¾¾å¼çš„å¸®åŠ©ä¿¡æ¯
   *
   * @param detailed - æ˜¯å¦æ˜¾ç¤ºè¯¦ç»†å¸®åŠ©
   * @returns å¸®åŠ©æ–‡æœ¬
   */
  getHelp(detailed: boolean = false): string {
    // å¦‚æœä¸éœ€è¦è¯¦ç»†å¸®åŠ©ï¼Œè¿”å›ç®€è¦ç‰ˆæœ¬
    if (!detailed) {
      return this.getBriefHelp()
    }

    // è¿”å›å®Œæ•´çš„è¯¦ç»†å¸®åŠ©
    return `ğŸ² éª°å­ç³»ç»Ÿå®Œæ•´æŒ‡å—

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“– åŸºç¡€ç”¨æ³•
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
.r <è¡¨è¾¾å¼>        - æ·éª°å­
.ra <è¡¨è¾¾å¼>       - ä½¿ç”¨æ¿€æ´»è§’è‰²æ·éª°
.rd <è¡¨è¾¾å¼> <æè¿°> - å¸¦æè¿°çš„æ·éª°
.rh                - æ˜¾ç¤ºæ­¤å¸®åŠ©

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ¯ åŸºç¡€éª°å­ç¤ºä¾‹
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
å•ä¸ªéª°å­ï¼š
  .r d20             â†’ æ· 1 ä¸ª 20 é¢éª°
  .r d6              â†’ æ· 1 ä¸ª 6 é¢éª°

å¤šä¸ªéª°å­ï¼š
  .r 3d6             â†’ æ· 3 ä¸ª 6 é¢éª°å¹¶æ±‚å’Œ
  .r 2d10            â†’ æ· 2 ä¸ª 10 é¢éª°å¹¶æ±‚å’Œ

å¸¦ä¿®æ­£å€¼ï¼š
  .r 3d6+2           â†’ æ· 3 ä¸ª 6 é¢éª°ï¼Œç»“æœåŠ  2
  .r 2d10-1          â†’ æ· 2 ä¸ª 10 é¢éª°ï¼Œç»“æœå‡ 1

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ”§ ä¿ç•™/ä¸¢å¼ƒä¿®é¥°ç¬¦
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
å±æ€§ç”Ÿæˆï¼ˆä¿ç•™æœ€é«˜ 3 ä¸ªï¼‰ï¼š
  .r 6d4kh3          â†’ æ· 6 ä¸ª 4 é¢éª°ï¼Œä¿ç•™æœ€é«˜çš„ 3 ä¸ª

D&D 5e äººç‰©å±æ€§ï¼ˆä¿ç•™æœ€é«˜ï¼‰ï¼š
  .r 4d6kh1          â†’ æ· 4 ä¸ª 6 é¢éª°ï¼Œä¿ç•™æœ€é«˜çš„ 1 ä¸ª

ä¸¢å¼ƒæœ€ä½ï¼ˆå»æ‰è¿æ°”æœ€å·®çš„ï¼‰ï¼š
  .r 4d6dl1          â†’ æ· 4 ä¸ª 6 é¢éª°ï¼Œä¸¢å¼ƒæœ€ä½çš„ 1 ä¸ª

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ”„ é‡éª°æœºåˆ¶
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
é‡éª°ä¸€æ¬¡ï¼ˆâ‰¤2 æ—¶é‡éª°ï¼‰ï¼š
  .r d10r2           â†’ æ·å‡º 1 æˆ– 2 æ—¶ï¼Œé‡éª°ä¸€æ¬¡
  .r 2d10r2          â†’ ä¸¤ä¸ªéª°å­åˆ†åˆ«åˆ¤æ–­æ˜¯å¦é‡éª°

é€’å½’é‡éª°ï¼ˆâ‰¤2 æ—¶æŒç»­é‡éª°ï¼‰ï¼š
  .r d10rr2          â†’ æ·å‡º 1 æˆ– 2 æ—¶ï¼ŒæŒç»­é‡éª°ç›´åˆ° â‰¥3
  .r 2d10rr2         â†’ ä¸¤ä¸ªéª°å­åˆ†åˆ«é€’å½’é‡éª°

å¤§å¤±è´¥æ£€æŸ¥ï¼ˆé‡éª° 1ï¼‰ï¼š
  .r d100r1          â†’ æ·å‡º 1 æ—¶é‡éª°ï¼Œé¿å…å¤§å¤±è´¥

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ’¥ çˆ†éª°æœºåˆ¶
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ç®€å•çˆ†éª°ï¼š
  .r d6!             â†’ æ·å‡º 6 æ—¶ï¼Œå†éª°ä¸€æ¬¡å¹¶ç´¯åŠ 
  .r d20!            â†’ æ·å‡º 20 æ—¶ï¼Œå†éª°ä¸€æ¬¡å¹¶ç´¯åŠ 

ç»„åˆä½¿ç”¨ï¼š
  .r 2d6!            â†’ æ¯ä¸ªéª°å­ç‹¬ç«‹çˆ†éª°
  .r 2d6!+3          â†’ çˆ†éª°ååŠ ä¿®æ­£å€¼

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ® TRPG æ¸¸æˆåœºæ™¯ç¤ºä¾‹
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
D&D 5e æ”»å‡»æ£€å®šï¼š
  .r d20+5           â†’ æ”»å‡»æ£€å®šï¼ˆ+5 æ˜¯æ”»å‡»åŠ å€¼ï¼‰
  .r 2d6+3           â†’ åŒæ‰‹å‰‘ä¼¤å®³ï¼ˆ2d6+3ï¼‰

D&D 5e ä¼˜åŠ¿/åŠ£åŠ¿ï¼š
  ä¼˜åŠ¿ï¼š.r 2d20kh1   â†’ æ· 2 ä¸ª d20ï¼Œä¿ç•™é«˜çš„
  åŠ£åŠ¿ï¼š.r 2d20kl1   â†’ æ· 2 ä¸ª d20ï¼Œä¿ç•™ä½çš„

CoC 7th æŠ€èƒ½æ£€å®šï¼š
  .r 1d100           â†’ åŸºç¡€ç™¾é¢éª°æ£€å®š
  .r d100r1          â†’ é¿å…å¤§å¤±è´¥ï¼ˆ1 é‡éª°ï¼‰

CoC 7th ä¼¤å®³æ·éª°ï¼š
  .r 1d8             â†’ æ­¦å™¨ä¼¤å®³
  .r d6+d6           â†’ å·¦å³æ‰‹ä¼¤å®³

å±æ€§ç”Ÿæˆï¼ˆD&D 5eï¼‰ï¼š
  .r 4d6kh1          â†’ æ ‡å‡†å±æ€§ç”Ÿæˆæ³•
  .r 3d6             â†’ ç»å…¸å±æ€§ç”Ÿæˆæ³•

å‘½è¿éª°ï¼ˆFATEï¼‰ï¼š
  .r 4d3-2           â†’ 4 ä¸ª Fate éª°ï¼ˆ+1,0,-1ï¼‰

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ§® å¤æ‚è¡¨è¾¾å¼
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
å¤šä¸ªéª°å­ç±»å‹ï¼š
  .r 3d6+2d4-1       â†’ 3d6 + 2d4 - 1
  .r 2d10+3d6+5      â†’ å¤æ‚ä¼¤å®³è®¡ç®—

ç»„åˆä¿®é¥°ç¬¦ï¼š
  .r 4d6kh1+2        â†’ ä¿ç•™æœ€é«˜ + ä¿®æ­£å€¼
  .r 2d10r2kh1       â†’ é‡éª° + ä¿ç•™æœ€é«˜

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“Š å®é™…è¾“å‡ºç¤ºä¾‹
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
.r d20
â†’ ğŸ² d20 = [15] = 15

.r 3d6+2
â†’ ğŸ² 3d6+2 = [4,5,3] + 2 = 14

.r 4d6kh1
â†’ ğŸ² 4d6kh1 = [4,5,3,2]â†’[5] = 5

.r 2d10r2
â†’ ğŸ² 2d10r2 [~~2~~â†’8,6] = 14  (é‡éª°: 2â†’8)

.r d20!
â†’ ğŸ² d20! = [20,5] = 25

.rd 2d6 "ç«çƒæœ¯ä¼¤å®³"
â†’ ç«çƒæœ¯ä¼¤å®³
  ğŸ² 2d6 = [4,3] = 7

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ’¡ å¸¸ç”¨é€ŸæŸ¥è¡¨
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
D&D 5e:
  å±æ€§ç”Ÿæˆï¼š4d6kh1
  æ”»å‡»æ£€å®šï¼šd20+X
  ä¼˜åŠ¿æ”»å‡»ï¼š2d20kh1+X
  åŠ£åŠ¿æ”»å‡»ï¼š2d20kl1+X

CoC 7th:
  æŠ€èƒ½æ£€å®šï¼š1d100
  ä¼¤å®³æ·éª°ï¼š1d8
  å±æ€§æ·éª°ï¼š3d6*5

é€šç”¨:
  éšæœºæ•°ï¼šd100
  ç¡¬å¸ï¼šd2
  ç™¾åˆ†æ¯”ï¼šd100

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âš ï¸ æ³¨æ„äº‹é¡¹
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â€¢ é™¤æ³•ä¸ºæ•´é™¤ï¼š7/2 = 3
â€¢ é‡éª°é˜ˆå€¼å¿…é¡» < éª°å­é¢æ•°
â€¢ çˆ†éª°å¯ä»¥è¿ç»­è§¦å‘
â€¢ ä¿®é¥°ç¬¦é¡ºåºä¸å½±å“ç»“æœ

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”`
  }

  /**
   * è·å–éª°å­è¡¨è¾¾å¼çš„ç¤ºä¾‹
   *
   * @param category - ç¤ºä¾‹ç±»åˆ«ï¼ˆbasic/advanced/dnd5e/coc7ï¼‰
   * @returns ç¤ºä¾‹æ–‡æœ¬
   */
  getExamples(category?: string): string {
    const examples: Record<string, string> = {
      basic: `ğŸ“š åŸºç¡€ç¤ºä¾‹

å•ä¸ªéª°å­ï¼š
  .r d20       â†’ æ· 1 ä¸ª 20 é¢éª°
  .r d6        â†’ æ· 1 ä¸ª 6 é¢éª°
  .r d100      â†’ æ· 1 ä¸ª 100 é¢éª°

å¤šä¸ªéª°å­ï¼š
  .r 3d6       â†’ æ· 3 ä¸ª 6 é¢éª°å¹¶æ±‚å’Œ
  .r 2d10      â†’ æ· 2 ä¸ª 10 é¢éª°å¹¶æ±‚å’Œ
  .r 4d8       â†’ æ· 4 ä¸ª 8 é¢éª°å¹¶æ±‚å’Œ

å¸¦ä¿®æ­£å€¼ï¼š
  .r 3d6+2     â†’ æ· 3 ä¸ª 6 é¢éª°ï¼Œç»“æœåŠ  2
  .r 2d10-1    â†’ æ· 2 ä¸ª 10 é¢éª°ï¼Œç»“æœå‡ 1
  .r d20+5     â†’ æ· 1 ä¸ª 20 é¢éª°ï¼Œç»“æœåŠ  5`,

      advanced: `ğŸ”§ è¿›é˜¶ç¤ºä¾‹

ä¿ç•™/ä¸¢å¼ƒä¿®é¥°ç¬¦ï¼š
  .r 4d6kh1    â†’ æ· 4 ä¸ª 6 é¢éª°ï¼Œä¿ç•™æœ€é«˜ 1 ä¸ª
  .r 4d6kl1    â†’ æ· 4 ä¸ª 6 é¢éª°ï¼Œä¿ç•™æœ€ä½ 1 ä¸ª
  .r 4d6dl1    â†’ æ· 4 ä¸ª 6 é¢éª°ï¼Œä¸¢å¼ƒæœ€ä½ 1 ä¸ª

é‡éª°æœºåˆ¶ï¼š
  .r 2d10r2    â†’ æ· 2 ä¸ª 10 é¢éª°ï¼Œâ‰¤2 æ—¶é‡éª°ä¸€æ¬¡
  .r d10rr2    â†’ æ· 1 ä¸ª 10 é¢éª°ï¼Œâ‰¤2 æ—¶é€’å½’é‡éª°
  .r d100r1    â†’ æ· 1 ä¸ª 100 é¢éª°ï¼Œæ·å‡º 1 æ—¶é‡éª°

çˆ†éª°æœºåˆ¶ï¼š
  .r d6!       â†’ æ· 1 ä¸ª 6 é¢éª°ï¼Œæ·å‡º 6 æ—¶çˆ†éª°
  .r d20!      â†’ æ· 1 ä¸ª 20 é¢éª°ï¼Œæ·å‡º 20 æ—¶çˆ†éª°
  .r 2d6!+3    â†’ 2 ä¸ª 6 é¢éª°çˆ†éª°ï¼Œç»“æœåŠ  3`,

      dnd5e: `ğŸ‰ D&D 5e ç¤ºä¾‹

æ”»å‡»æ£€å®šï¼š
  .r d20+5     â†’ æ”»å‡»æ£€å®šï¼ˆ+5 æ”»å‡»åŠ å€¼ï¼‰
  .r 2d20kh1   â†’ ä¼˜åŠ¿æ”»å‡»
  .r 2d20kl1   â†’ åŠ£åŠ¿æ”»å‡»
  .r d20+8     â†’ é«˜ç­‰çº§æ”»å‡»æ£€å®š

ä¼¤å®³æ·éª°ï¼š
  .r 2d6+3     â†’ åŒæ‰‹å‰‘ä¼¤å®³
  .r 1d8+4     â†’ é•¿å‰‘ä¼¤å®³
  .r 8d6       â†’ ç«çƒæœ¯ä¼¤å®³

å±æ€§ç”Ÿæˆï¼š
  .r 4d6kh1    â†’ æ ‡å‡†å±æ€§ç”Ÿæˆï¼ˆé€‰æœ€é«˜ï¼‰
  .r 3d6       â†’ ç»å…¸å±æ€§ç”Ÿæˆ
  .r 5d6kh3    â†’ é«˜èƒ½åŠ›å±æ€§ç”Ÿæˆ`,

      coc7: `ğŸ™ CoC 7th ç¤ºä¾‹

æŠ€èƒ½æ£€å®šï¼š
  .r 1d100     â†’ åŸºç¡€æ£€å®š
  .r d100      â†’ ç®€å†™å½¢å¼
  .r d100r1    â†’ é¿å…å¤§å¤±è´¥ï¼ˆ1 é‡éª°ï¼‰

ä¼¤å®³æ·éª°ï¼š
  .r 1d8       â†’ æ­¦å™¨ä¼¤å®³
  .r 1d10      â†’ é‡å‹æ­¦å™¨ä¼¤å®³
  .r d6+d6     â†’ å·¦å³æ‰‹ä¼¤å®³

å±æ€§æ·éª°ï¼š
  .r 3d6*5     â†’ åŠ›é‡å±æ€§
  .r 3d6*5     â†’ æ™ºåŠ›å±æ€§
  .r (3d6+3d6)*10 â†’ æ•™è‚²ï¼ˆç‰¹æ®Šï¼‰`,
    }

    if (category && examples[category]) {
      return examples[category]
    }
    return Object.values(examples).join('\n\n')
  }
}

/**
 * åˆ›å»ºéª°å­æœåŠ¡å®ä¾‹
 *
 * @param ctx - Koishi ä¸Šä¸‹æ–‡
 * @returns éª°å­æœåŠ¡å®ä¾‹
 */
export function createDiceService(ctx: Context): DiceService {
  return new DiceService(ctx)
}
